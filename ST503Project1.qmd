---
title: "ST 558 Project 1"
format: html
editor: visual
---

## Data Processing

```{r}
# Load packages
library(tidyverse)
library(readxl)
library(DBI)
```

```{r}
# Read in the data
data1 <- read_csv("EDU01a.csv")
```

#### 1. Only select the columns identified in the instructional document

```{r}
# Name the data frame
selected_data1 <- data1 %>%

# Select the respective columns
  select(Area_name, STCOU, ends_with("D")) %>%

# Rename the Area_name variable
  rename(area_name = Area_name)
```

#### 2. Convert the data into long format

```{r}
long_data1 <- pivot_longer(selected_data1, cols = ends_with("D"), names_to = "Survey", values_to = "Enrollment Value")
```

#### 3. Survey values

```{r}
long_data1 |>
  # Creating Year variable that gets the year values from the Survey string
  mutate(Year = as.numeric(substr(Survey, start = 8, stop = 9))) |>
  # Adding the 1900 or 2000 to the yearvals variable to get the actual year and overwriting that variable
  mutate(Year = ifelse(Year > 25, Year + 1900, Year + 2000)) |>
  # Creating variable for the first 3 characters and 4 digits of the Survey string
  mutate(Measurement = substr(Survey, start = 1, stop = 7))
```

## Functions

#### Function to select necessary columns and convert the data into long format

```{r}
Long_Format_Conversion <- function(df, value = "Enrollment Value") {
  selected_data <- df %>%

# Select the respective columns
  select(Area_name, STCOU, ends_with("D")) %>%

# Rename the Area_name variable
  rename(area_name = Area_name)
  
# Converting data to the long format
  long_data <- pivot_longer(selected_data, cols = ends_with("D"), names_to = "Survey", values_to = value)
  return(long_data1)
}
```

#### Testing this function

```{r}
data2 <- read_csv("EDU01B.csv")
long_data2 <- Long_Format_Conversion(data2)
long_data2
```

#### Function for pulling out year and measurement from the survey values

```{r}
Survey_Function <- function(long_df) {
  long_df |>
  # Creating Year variable that gets the year values from the Survey string
  mutate(Year = as.numeric(substr(Survey, start = 8, stop = 9))) |>
  # Adding the 1900 or 2000 to the yearvals variable to get the actual year and overwriting that variable
  mutate(Year = ifelse(Year > 25, Year + 1900, Year + 2000)) |>
  # Creating variable for the first 3 characters and 4 digits of the Survey string
  mutate(Measurement = substr(Survey, start = 1, stop = 7))
}
```

#### Testing this Function

```{r}
Survey_Function(long_data2)
```









